# Gloria-Code-Generator

[![standard-readme compliant](https://img.shields.io/badge/standard--readme-OK-green.svg?style=flat-square)](https://github.com/RichardLitt/standard-readme)

[简体中文](./readme.md) | English

[Gloria](gloria.pub) is a **programmable** website notification aggregator on **Chrome**, which can regularly grab new content on the website through a custom code to pop up notification reminders. This project is intended to further facilitate users (including users with poor coding skills) to use Gloria for customized information aggregation and capture. Using the Gloria plug-in can save time for page-by-page access to view information. Also, running the program on Chrome with cookies can save the trouble of writing crawlers for each page. Using this project, you can easily generate Gloria tasks and filters, and achieve 0 programming costs to deploy information aggregation and crawling services. 

At present, two generators are designed:: **ordinary task generator** and **reducer generator**. Through these two programs, you can regularly capture the notification of the specified page and push it to PC, mobile phones, and other devices. You can visit [this page](https://gloria.pub/tasks) to add more realized tasks or tasks generated by this project. The working effect on the PC and WeChat is shown in the figure below:

![pc_and_weixin](./imgs/pc_and_weixin.png)

## Table of Contents

- [Background](#background)
- [Install](#install)
- [Usage](#usage)
- [TODO](#TODO)
- [Relative Efforts](#RelativeEfforts)
- [Maintainers](#maintainers)
- [Contributing](#contributing)
- [License](#license)

## Background

After discovering the treasure plug-in Gloria, I wrote many scripts and used them by myself in order to grab information from the websites I concern. Gloria's official [tutorial](http://docs.gloria.pub/) gives the customizable items of the Gloria plug-in. According to my personal understanding, it is a task and a filter that can be customized by users. Among them, there can be multiple tasks running in Gloria at the same time, each with its own thread, which does not pollute each other; the filter is mainly responsible for filtering the captured information and selecting valuable items for pushing. Since the two parts of the code are injected into the plugin in the form of javascript, private code can be further entrapped in the two parts of the code, such as adding a fetch statement to achieve a get / post request, thereby achieving the function of synchronously pushing notification to other devices .

I wrote many tasks, and found a lot of data synchronization providers, and finally customized Gloria into a Chrome plugin that saved me energy. I also deployed Gloria to my windows server to push notifications to the mobile terminals 24 / 7 (if there is a channel API, you can also implement one-to-many push). But when I tried to recommend this tool to my friends, I found that they were somewhat unacceptable for this more programming-dependent plugin. So I wrote this Gloria code generator using python, which can somehow remove the barrier for users to use Gloria.

## Install

* ** with python3 environment **

   Use git clone or download zip directly

```
git@github.com:BHMulberry/gloria_code_generator.git
```

* ** without python3 environment **

Download [exe version in release](https://github.com/BHMulberry/gloria_code_generator/releases), or [download and install python](https://www.python.org/) to open the door to a new world

## Usage

The current version of the task generator only supports basic notifications, such as grabbing notifications in a notification bar. To generate the task code using the task generator, you need to determine the following variables (here to grab the [China Earthquake Administration](https://www.cea.gov.cn/cea/xwzx/369242/index.html) page information broadcast column for example):

`WEB_PAGE`: the address of the target page, which is`'https://www.cea.gov.cn/cea/xwzx/369242/index.html'`

`TARGET_DIR`: the location of the box model of the target notification, which can be seen using the browser ’s review element function, in this case` '.listNews.pagelib ul li'`

`URL_ROOT`: The prefix of the target notification link. If you see that the target notification link is incomplete in the review element, you need to add a prefix to each target link you get. If you are not sure about the prefix, you can click directly to see The link address of a target notification can be known. Here is `https://www.cea.gov.cn` (if the target notification link is complete, set it to blank here)

`ICON_URL`: The icon of the target notification, you can statically select the logo of the notification page (you can directly find the logo picture to see its address and fill it here), or you can dynamically select the picture link that comes with each notification, or you can leave it blank (Gloria will send notifications with default icons). Here, the static logo of the China Earthquake Administration is used as the notification icon, that is, `'https://pic1.zhimg.com/50/v2-c66d7a89ec2cae81fd27e021111129f7_qhd.jpg'`

* ** with python3 environment **

Modify the value of each variable in the code and the saved file name and execute it at the command line

```
python generate_gloria_task.py
```

* ** No python3 environment **

 Enter the variable values step by step according to the exe prompt (you can also paste)

After generating the code, use Notepad or other software to view the text, copy it all, paste the generated code at **Gloria - Advanced - Test Task Code**, click the test button to test, Chrome will push the notification of the test Receiving the target notification is success. After the test is successful, paste the code at **Gloria - task - plus sign button in the lower right corner**, click Next, and set the periodic execution period.

## TODO

* GUI
* Automatically find the path of the corresponding notification bar  according to the sub-page link, further simplifying the process of generating code
* More complex task templates, such as monitoring specific values in web pages and setting threshold for pushing notifications
* Added regular string filtering function in reducer template
* More service providers' multi-device synchronization API template support

## RelativeEfforts

* [Gloria](https://github.com/BlackGlory/Gloria/) - Gloria plugin used in this project
* [Node-ServerChan](https://github.com/xfoxfu/node-ServerChan) - [ServerChan](http://sc.ftqq.com) Node.js SDK, which is used in this project for pushing notifications to WeChat. 

## Maintainers

[@BHMulberry](https://github.com/BHMulberry)

## Contributing

PRs accepted.

Small note: If editing the README, please conform to the [standard-readme](https://github.com/RichardLitt/standard-readme) specification.

## License

MIT © 2020 BHMulberry
